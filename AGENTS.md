# Repository Guidelines
## Project Structure & Module Organization
Dittofeed lives under `dittofeed/` and uses Yarn 4 workspaces. Core runtime code sits in `packages/backend-lib` (shared domain logic, database migrations, Temporal helpers), `packages/api` (Fastify HTTP API and bootstrap scripts), `packages/worker` (Temporal and queue workers), and `packages/dashboard` (Next.js app). Editor utilities reside in `packages/emailo`, while docs and marketing content live in `packages/docs`. Tests are colocated with source files and in `packages/backend-lib/test` for integration harnesses. Supporting assets include `docker-compose*.yaml` for local infrastructure, `scripts/` for CLI automation, and `examples/` for reference journeys.
## Build, Test, and Development Commands
- `./dev-setup.sh` installs dependencies, builds shared packages, and runs `yarn admin bootstrap` to seed required configuration.
- `docker compose up --build` (choose the appropriate compose file) provisions Postgres, Temporal, ClickHouse, and support services expected by the API and worker.
- `yarn workspace api dev` launches the Fastify API; pair it with an `.env` generated by `yarn workspace backend-lib config-env`.
- `yarn workspace dashboard dev` starts the Next.js dashboard; `yarn workspace worker dev` runs the Temporal worker loop.
## Coding Style & Naming Conventions
TypeScript is mandatory across packages. Prettier 3.2.5 and the Airbnb TypeScript ESLint suite enforce two-space indentation, single quotes, trailing commas, and sorted imports (`simple-import-sort`). The `filenames/no-index` rule bans anonymous `index.ts(x)` files—prefer descriptive PascalCase for React components and camelCase for utilities. Run `yarn workspace <package> lint` before sending changes and format with `npx prettier --write` when edits span multiple files.
## Testing Guidelines
Jest is configured as a multi-project runner (`jest.config.js`). Use `yarn jest` for the full suite, or `yarn jest --selectProjects backend-lib` (or `api`, `dashboard`, `emailo`) to scope runs. The backend tests rely on dockerised services; ensure the compose stack is healthy before invoking the suite. Add new tests next to the code under test using the `*.test.ts` naming pattern, and extend `packages/backend-lib/test` fixtures when adding integration scenarios. Aim to cover new branches and document flaky tests in PR descriptions.
## Commit & Pull Request Guidelines
Recent history favors concise, imperative summaries (e.g., “Move files to company github”). Keep subject lines under 72 characters and include body bullets for context, migrations, or follow-ups. Reference issue IDs when available. Pull requests should state the motivation, list manual test commands, and call out config or schema changes. Attach screenshots or clips for dashboard UI updates and link to demo data when relevant.
## Security & Configuration Tips
Secrets and environment values stay local; never commit generated `.env` files. Use `yarn workspace backend-lib config-env` to scaffold safe defaults and review `docker-compose.lite.yaml` when you only need the minimal stack. Rotate API keys before sharing recordings or logs, and audit scripts in `scripts/` for hard-coded paths before rerunning in CI.
